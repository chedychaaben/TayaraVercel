{"version":3,"sources":["utils/axiosInstance.js","context/AuthContext.js","pages/HomePage.js","pages/LoginPage.js","components/Header.js","utils/PrivateRoute.js","App.js","index.js"],"names":["authTokens","localStorage","getItem","JSON","parse","axiosInstance","axios","create","baseURL","headers","Authorization","concat","access","interceptors","request","use","_ref","Object","asyncToGenerator","_regeneratorRuntime","mark","_callee","req","user","response","wrap","_context","prev","next","jwt_decode","dayjs","unix","exp","diff","abrupt","post","refresh","sent","setItem","stringify","data","stop","_x","apply","this","arguments","AuthContext","createContext","AuthProvider","children","_useState","useState","_useState2","slicedToArray","setAuthTokens","_useState3","_useState4","setUser","_useState5","_useState6","loading","setLoading","history","useHistory","contextData","loginUser","_ref2","AuthContext_regeneratorRuntime","e","preventDefault","email","target","value","password","status","push","alert","logoutUser","removeItem","useEffect","react_default","a","createElement","Provider","HomePage","annonces","setAnnonces","_useContext","useContext","getAnnonces","HomePage_regeneratorRuntime","get","console","log","map","annonce","key","id","titre","LoginPage","onSubmit","type","name","placeholder","Header","react_router_dom","to","onClick","PrivateRoute","rest","objectWithoutProperties","react_router","App","className","AuthContext_AuthProvider","components_Header","utils_PrivateRoute","path","exact","component","ReactDOM","createRoot","document","getElementById","render","src_App"],"mappings":"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","file":"static/js/main.8dbac547.chunk.js","sourcesContent":["import axios from 'axios'\nimport jwt_decode from \"jwt-decode\"\nimport dayjs from 'dayjs'\n\n\nconst baseURL = 'http://127.0.0.1:8000'\n\n// WHY SO SLOW IS IT BECAUSE WE ARE STORING IN LOCALSTORAGE\nlet authTokens = localStorage.getItem('authTokens') ? JSON.parse(localStorage.getItem('authTokens')) : null\n\nconst axiosInstance = axios.create({\n    baseURL,\n    headers:{Authorization: `Bearer ${authTokens?authTokens.access:null}`}\n})\n\n// Before sending a request\n\naxiosInstance.interceptors.request.use(async req => {\n    if (! authTokens){\n        authTokens = localStorage.getItem('authTokens') ? JSON.parse(localStorage.getItem('authTokens')) : null\n        req.headers.Authorization = `Bearer ${authTokens ? authTokens.access : null}`\n    }\n\n    const user = jwt_decode(authTokens.access)\n    const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\n    \n    if (! isExpired) return req\n\n    // If isExpired => Go for refresh with the old refresh and then set the new tokens then continue the request with the new access token\n    const response = await axios.post(`${baseURL}/api/token/refresh/`,{ \n        refresh : authTokens.refresh\n    })\n    // Then Update the localstorage with new values \n    localStorage.setItem('authTokensnew', JSON.stringify(response.data))\n\n    // Update headers again with the new token\n    req.headers.Authorization = `Bearer ${authTokens ? authTokens.access : null}`\n    return req\n})\n\nexport default axiosInstance;","import React, { createContext, useState, useEffect } from 'react'\nimport jwt_decode from \"jwt-decode\";\nimport { useHistory } from 'react-router-dom'\nimport axiosInstance from '../utils/axiosInstance'\nimport axios from 'axios';\n\nconst AuthContext = createContext()\n\nexport default AuthContext;\n\n\nexport const AuthProvider = ({children}) => {\n    let [authTokens, setAuthTokens] = useState(()=> localStorage.getItem('authTokens') ? JSON.parse(localStorage.getItem('authTokens')) : null)\n    let [user, setUser] = useState(()=> localStorage.getItem('authTokens') ? jwt_decode(localStorage.getItem('authTokens')) : null)\n    let [loading, setLoading] = useState(true)\n\n    const history = useHistory()\n\n    let loginUser = async (e )=> {\n        e.preventDefault()\n        let response = await axios.post('http://127.0.0.1:8000/api/token/',\n            {'email':e.target.email.value, 'password':e.target.password.value}\n        )\n        if(response.status === 200){\n            setAuthTokens(response.data)\n            setUser(jwt_decode(response.data.access))\n            localStorage.setItem('authTokens', JSON.stringify(response.data))\n            history.push('/')\n        }else{\n            alert('Something went wrong!')\n        }\n    }\n\n\n    let logoutUser = () => {\n        setAuthTokens(null)\n        setUser(null)\n        localStorage.removeItem('authTokens')\n        history.push('/login')\n    }\n\n\n\n    let contextData = {\n        user:user,\n        authTokens:authTokens,\n        loginUser:loginUser,\n        logoutUser:logoutUser,\n    }\n\n\n    useEffect(()=> {\n\n        if(authTokens){\n            setUser(jwt_decode(authTokens.access))\n        }\n        setLoading(false)\n\n\n    }, [authTokens, loading])\n\n    return(\n        <AuthContext.Provider value={contextData} >\n            {loading ? null : children}\n        </AuthContext.Provider>\n    )\n}\n","import React, {useContext, useState, useEffect} from 'react'\nimport AuthContext from '../context/AuthContext'\nimport axiosInstance from '../utils/axiosInstance'\n\nconst HomePage = () => {\n  let [annonces, setAnnonces] = useState([])\n  let {user, authTokens, logoutUser} = useContext(AuthContext)\n\n  useEffect( () => {\n    getAnnonces()\n  }, [])\n\n  let getAnnonces = async() => {\n    let response = await axiosInstance.get('/api/')\n    if (response.status === 200){\n        console.log('OK')\n        setAnnonces(response.data)\n    }\n  }\n  \n  return (\n    <div>\n      <p>You are logged to the home page!</p>\n      <h1>Hello {user.email}</h1>\n      <ul>\n        {annonces.map(annonce => (\n          <li key={annonce.id}>{annonce.titre}</li>\n        ))}\n      </ul>\n    </div>\n  )\n}\n\nexport default HomePage","import React, {useContext} from 'react'\nimport AuthContext from '../context/AuthContext'\n\nconst LoginPage = () => {\n    let {loginUser} = useContext(AuthContext)\n    return (\n      <div>\n        <form onSubmit={loginUser}>\n          <input type=\"email\" name=\"email\" placeholder=\"Enter Username\" />\n          <input type=\"password\" name=\"password\" placeholder=\"Enter Password\" />\n          <input type=\"submit\" />\n        </form>\n      </div>\n    )\n}\n\nexport default LoginPage\n","import React, {useContext} from 'react'\nimport AuthContext from '../context/AuthContext'\nimport { Link } from 'react-router-dom'\n\nconst Header = () => {\n  let {logoutUser} = useContext(AuthContext)\n  return (\n    <div>\n      <Link to=\"/\">Home</Link>\n      <span>  |  </span>\n      <Link to=\"/login\">Login</Link>\n      <span>  |  </span>\n      <Link onClick={ () => {logoutUser()} }>Logout</Link>\n    </div>\n  )\n}\n\nexport default Header\n","import React, { useContext } from 'react'\nimport { Route, Redirect } from 'react-router-dom'\nimport AuthContext from '../context/AuthContext';\n\n\nconst PrivateRoute = ({children, ...rest}) => {\n    let {user} = useContext(AuthContext);\n    return (\n        <Route {...rest}>\n            {\n            !user ? \n                <Redirect to=\"login\" /> \n            : children\n            }\n        </Route>\n    )\n}\n\nexport default PrivateRoute;","import React from 'react';\nimport './App.css';\nimport { BrowserRouter as Router, Route} from 'react-router-dom';\n\nimport { AuthProvider } from './context/AuthContext'\n\nimport HomePage from './pages/HomePage'\nimport LoginPage from './pages/LoginPage';\nimport Header from './components/Header';\nimport PrivateRoute from './utils/PrivateRoute';\n\n\n\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Router>\n        <AuthProvider>\n\n          <Header/>\n          <PrivateRoute path=\"/\" exact component={HomePage} />\n          <Route path=\"/login\" component={LoginPage} />\n\n        </AuthProvider>\n      </Router>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport App from './App';\n\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(\n  <App />\n);\n/*<React.StrictMode>\n    <App />\n  </React.StrictMode>*/"],"sourceRoot":""}