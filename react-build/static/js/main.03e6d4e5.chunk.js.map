{"version":3,"sources":["context/AuthContext.js","pages/HomePage.js","pages/LoginPage.js","components/Header.js","utils/PrivateRoute.js","App.js","index.js"],"names":["AuthContext","createContext","AuthProvider","_ref","children","_useState","useState","localStorage","getItem","JSON","parse","_useState2","Object","slicedToArray","authTokens","setAuthTokens","_useState3","jwt_decode","_useState4","user","setUser","_useState5","_useState6","loading","setLoading","history","useHistory","loginUser","_ref2","asyncToGenerator","_regeneratorRuntime","mark","_callee","e","response","data","wrap","_context","prev","next","preventDefault","fetch","method","headers","Content-Type","body","stringify","email","target","value","password","sent","json","status","access","setItem","push","alert","stop","_x","apply","this","arguments","logoutUser","removeItem","updateToken","_ref3","_callee2","_context2","refresh","contextData","useEffect","interval","setInterval","clearInterval","react_default","a","createElement","Provider","HomePage","annonces","setAnnonces","_useContext","useContext","getAnnonces","HomePage_regeneratorRuntime","Authorization","String","statusText","map","annonce","key","id","titre","LoginPage","onSubmit","type","name","placeholder","Header","react_router_dom","to","onClick","PrivateRoute","rest","objectWithoutProperties","react_router","App","className","AuthContext_AuthProvider","components_Header","utils_PrivateRoute","path","exact","component","ReactDOM","createRoot","document","getElementById","render","StrictMode","src_App"],"mappings":"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","file":"static/js/main.03e6d4e5.chunk.js","sourcesContent":["import React, { createContext, useState, useEffect } from 'react'\nimport jwt_decode from \"jwt-decode\";\nimport { useHistory } from 'react-router-dom'\n\nconst AuthContext = createContext()\n\nexport default AuthContext;\n\n\nexport const AuthProvider = ({children}) => {\n    let [authTokens, setAuthTokens] = useState(()=> localStorage.getItem('authTokens') ? JSON.parse(localStorage.getItem('authTokens')) : null)\n    let [user, setUser] = useState(()=> localStorage.getItem('authTokens') ? jwt_decode(localStorage.getItem('authTokens')) : null)\n    let [loading, setLoading] = useState(true)\n\n    const history = useHistory()\n\n    let loginUser = async (e )=> {\n        e.preventDefault()\n        let response = await fetch('http://127.0.0.1:8000/api/token/', {\n            method:'POST',\n            headers:{\n                'Content-Type':'application/json'\n            },\n            body:JSON.stringify({'email':e.target.email.value, 'password':e.target.password.value})\n        })\n        let data = await response.json()\n\n        if(response.status === 200){\n            setAuthTokens(data)\n            setUser(jwt_decode(data.access))\n            localStorage.setItem('authTokens', JSON.stringify(data))\n            history.push('/')\n        }else{\n            alert('Something went wrong!')\n        }\n    }\n\n\n    let logoutUser = () => {\n        setAuthTokens(null)\n        setUser(null)\n        localStorage.removeItem('authTokens')\n        history.push('/login')\n    }\n\n\n    let updateToken = async ()=> {\n        let response = await fetch('http://127.0.0.1:8000/api/token/refresh/', {\n            method:'POST',\n            headers:{\n                'Content-Type':'application/json'\n            },\n            body:JSON.stringify({'refresh':authTokens? authTokens.refresh : null})\n        })\n\n        let data = await response.json()\n        \n        if (response.status === 200){\n            setAuthTokens(data)\n            setUser(jwt_decode(data.access))\n            localStorage.setItem('authTokens', JSON.stringify(data))\n        }else{\n            logoutUser()\n        }\n\n        if(loading){\n            setLoading(false)\n        }\n    }\n\n    let contextData = {\n        user:user,\n        authTokens:authTokens,\n        loginUser:loginUser,\n        logoutUser:logoutUser,\n    }\n\n\n    useEffect(()=> {\n\n        if(loading){\n            updateToken()\n        }\n\n        let fourMinutes = 1000 * 60 * 4\n\n        let interval =  setInterval(()=> {\n            if(authTokens){\n                updateToken()\n            }\n        }, fourMinutes)\n        return ()=> clearInterval(interval)\n\n    }, [authTokens, loading])\n\n    return(\n        <AuthContext.Provider value={contextData} >\n            {loading ? null : children}\n        </AuthContext.Provider>\n    )\n}\n","import React, {useContext, useState, useEffect} from 'react'\nimport AuthContext from '../context/AuthContext'\n\nconst HomePage = () => {\n  let [annonces, setAnnonces] = useState([])\n  let {user, authTokens, logoutUser} = useContext(AuthContext)\n\n  useEffect( () => {\n    getAnnonces()\n  }, [])\n\n  let getAnnonces = async() => {\n    let response = await fetch('http://127.0.0.1:8000/api/', {\n      method:'GET',\n      headers:{\n        'Content-Type' : 'application/json',\n        'Authorization' : 'Bearer ' + String(authTokens.access)\n      }\n    })\n    let data = await response.json()\n    //\n    if (response.status === 200){\n        setAnnonces(data)\n    }else if(response.statusText==='Unauthorized'){\n      logoutUser()\n    }\n  }\n  \n  return (\n    <div>\n      <p>You are logged to the home page!</p>\n      <h1>Hello {user.email}</h1>\n      <ul>\n        {annonces.map(annonce => (\n          <li key={annonce.id}>{annonce.titre}</li>\n        ))}\n      </ul>\n    </div>\n  )\n}\n\nexport default HomePage","import React, {useContext} from 'react'\nimport AuthContext from '../context/AuthContext'\n\nconst LoginPage = () => {\n    let {loginUser} = useContext(AuthContext)\n    return (\n      <div>\n        <form onSubmit={loginUser}>\n          <input type=\"email\" name=\"email\" placeholder=\"Enter Username\" />\n          <input type=\"password\" name=\"password\" placeholder=\"Enter Password\" />\n          <input type=\"submit\" />\n        </form>\n      </div>\n    )\n}\n\nexport default LoginPage\n","import React, {useContext} from 'react'\nimport AuthContext from '../context/AuthContext'\nimport { Link } from 'react-router-dom'\n\nconst Header = () => {\n  let {logoutUser} = useContext(AuthContext)\n  return (\n    <div>\n      <Link to=\"/\">Home</Link>\n      <span>  |  </span>\n      <Link to=\"/login\">Login</Link>\n      <span>  |  </span>\n      <Link onClick={ () => {logoutUser()} }>Logout</Link>\n    </div>\n  )\n}\n\nexport default Header\n","import React, { useContext } from 'react'\nimport { Route, Redirect } from 'react-router-dom'\nimport AuthContext from '../context/AuthContext';\n\n\nconst PrivateRoute = ({children, ...rest}) => {\n    let {user} = useContext(AuthContext);\n    return (\n        <Route {...rest}>\n            {\n            !user ? \n                <Redirect to=\"login\" /> \n            : children\n            }\n        </Route>\n    )\n}\n\nexport default PrivateRoute;","import React from 'react';\nimport './App.css';\nimport { BrowserRouter as Router, Route} from 'react-router-dom';\n\nimport { AuthProvider } from './context/AuthContext'\n\nimport HomePage from './pages/HomePage'\nimport LoginPage from './pages/LoginPage';\nimport Header from './components/Header';\nimport PrivateRoute from './utils/PrivateRoute';\n\n\n\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Router>\n        <AuthProvider>\n\n          <Header/>\n          <PrivateRoute path=\"/\" exact component={HomePage} />\n          <Route path=\"/login\" component={LoginPage} />\n\n        </AuthProvider>\n      </Router>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport App from './App';\n\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);"],"sourceRoot":""}