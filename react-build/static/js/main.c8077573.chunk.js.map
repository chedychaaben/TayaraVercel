{"version":3,"sources":["utils/axiosInstance.js","context/AuthContext.js","pages/HomePage.js","pages/LoginPage.js","components/Header.js","utils/PrivateRoute.js","App.js","index.js"],"names":["authTokens","localStorage","getItem","JSON","parse","axiosInstance","axios","create","baseURL","headers","Authorization","concat","access","interceptors","request","use","_ref","Object","asyncToGenerator","_regeneratorRuntime","mark","_callee","req","user","response","wrap","_context","prev","next","jwt_decode","dayjs","unix","exp","diff","abrupt","post","refresh","sent","setItem","stringify","data","stop","_x","apply","this","arguments","AuthContext","createContext","AuthProvider","children","_useState","useState","_useState2","slicedToArray","setAuthTokens","_useState3","_useState4","setUser","_useState5","_useState6","loading","setLoading","history","useHistory","loginUser","_ref2","AuthContext_regeneratorRuntime","e","preventDefault","email","target","value","password","status","push","alert","logoutUser","removeItem","updateToken","_ref3","_callee2","_context2","contextData","useEffect","interval","setInterval","clearInterval","react_default","a","createElement","Provider","HomePage","annonces","setAnnonces","_useContext","useContext","getAnnonces","HomePage_regeneratorRuntime","get","console","log","map","annonce","key","id","titre","LoginPage","onSubmit","type","name","placeholder","Header","react_router_dom","to","onClick","PrivateRoute","rest","objectWithoutProperties","react_router","App","className","AuthContext_AuthProvider","components_Header","utils_PrivateRoute","path","exact","component","ReactDOM","createRoot","document","getElementById","render","src_App"],"mappings":"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","file":"static/js/main.c8077573.chunk.js","sourcesContent":["import axios from 'axios'\nimport jwt_decode from \"jwt-decode\"\nimport dayjs from 'dayjs'\n\n\nconst baseURL = 'http://127.0.0.1:8000'\n\n// WHY SO SLOW IS IT BECAUSE WE ARE STORING IN LOCALSTORAGE\nlet authTokens = localStorage.getItem('authTokens') ? JSON.parse(localStorage.getItem('authTokens')) : null\n\nconst axiosInstance = axios.create({\n    baseURL,\n    headers:{Authorization: `Bearer ${authTokens?authTokens.access:null}`}\n})\n\n// Before sending a request\n\naxiosInstance.interceptors.request.use(async req => {\n    if (! authTokens){\n        authTokens = localStorage.getItem('authTokens') ? JSON.parse(localStorage.getItem('authTokens')) : null\n        req.headers.Authorization = `Bearer ${authTokens ? authTokens.access : null}`\n    }\n\n    const user = jwt_decode(authTokens.access)\n    const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\n    \n    if (! isExpired) return req\n\n    // If isExpired => Go for refresh with the old refresh and then set the new tokens then continue the request with the new access token\n    const response = await axios.post(`${baseURL}/api/token/refresh/`,{ \n        refresh : authTokens.refresh\n    })\n    // Then Update the localstorage with new values \n    localStorage.setItem('authTokensnew', JSON.stringify(response.data))\n\n    // Update headers again with the new token\n    req.headers.Authorization = `Bearer ${authTokens ? authTokens.access : null}`\n    return req\n})\n\nexport default axiosInstance;","import React, { createContext, useState, useEffect } from 'react'\nimport jwt_decode from \"jwt-decode\";\nimport { useHistory } from 'react-router-dom'\nimport axiosInstance from '../utils/axiosInstance'\nimport axios from 'axios';\n\nconst AuthContext = createContext()\n\nexport default AuthContext;\n\n\nexport const AuthProvider = ({children}) => {\n    let [authTokens, setAuthTokens] = useState(()=> localStorage.getItem('authTokens') ? JSON.parse(localStorage.getItem('authTokens')) : null)\n    let [user, setUser] = useState(()=> localStorage.getItem('authTokens') ? jwt_decode(localStorage.getItem('authTokens')) : null)\n    let [loading, setLoading] = useState(true)\n\n    const history = useHistory()\n\n    let loginUser = async (e )=> {\n        e.preventDefault()\n        let response = await axios.post('http://127.0.0.1:8000/api/token/',\n            {'email':e.target.email.value, 'password':e.target.password.value}\n        )\n        if(response.status === 200){\n            setAuthTokens(response.data)\n            setUser(jwt_decode(response.data.access))\n            localStorage.setItem('authTokens', JSON.stringify(response.data))\n            history.push('/')\n        }else{\n            alert('Something went wrong!')\n        }\n    }\n\n\n    let logoutUser = () => {\n        setAuthTokens(null)\n        setUser(null)\n        localStorage.removeItem('authTokens')\n        history.push('/login')\n    }\n\n\n    let updateToken = async ()=> {\n        let response = await axios.post('http://127.0.0.1:8000/api/token/refresh/',\n            {'refresh':authTokens? authTokens.refresh : null}\n        )\n        \n        if (response.status === 200){\n            setAuthTokens(response.data)\n            setUser(jwt_decode(response.data.access))\n            localStorage.setItem('authTokens', JSON.stringify(response.data))\n        }else{\n            logoutUser()\n        }\n\n        if(loading){\n            setLoading(false)\n        }\n    }\n\n    let contextData = {\n        user:user,\n        authTokens:authTokens,\n        loginUser:loginUser,\n        logoutUser:logoutUser,\n    }\n\n\n    useEffect(()=> {\n\n        if(loading){\n            updateToken()\n        }\n\n        let fourMinutes = 1000 * 60 * 4\n\n        let interval =  setInterval(()=> {\n            if(authTokens){\n                updateToken()\n            }\n        }, fourMinutes)\n        return ()=> clearInterval(interval)\n\n    }, [authTokens, loading])\n\n    return(\n        <AuthContext.Provider value={contextData} >\n            {loading ? null : children}\n        </AuthContext.Provider>\n    )\n}\n","import React, {useContext, useState, useEffect} from 'react'\nimport AuthContext from '../context/AuthContext'\nimport axiosInstance from '../utils/axiosInstance'\n\nconst HomePage = () => {\n  let [annonces, setAnnonces] = useState([])\n  let {user, authTokens, logoutUser} = useContext(AuthContext)\n\n  useEffect( () => {\n    getAnnonces()\n  }, [])\n\n  let getAnnonces = async() => {\n    let response = await axiosInstance.get('/api/')\n    if (response.status === 200){\n        console.log('OK')\n        setAnnonces(response.data)\n    }\n  }\n  \n  return (\n    <div>\n      <p>You are logged to the home page!</p>\n      <h1>Hello {user.email}</h1>\n      <ul>\n        {annonces.map(annonce => (\n          <li key={annonce.id}>{annonce.titre}</li>\n        ))}\n      </ul>\n    </div>\n  )\n}\n\nexport default HomePage","import React, {useContext} from 'react'\nimport AuthContext from '../context/AuthContext'\n\nconst LoginPage = () => {\n    let {loginUser} = useContext(AuthContext)\n    return (\n      <div>\n        <form onSubmit={loginUser}>\n          <input type=\"email\" name=\"email\" placeholder=\"Enter Username\" />\n          <input type=\"password\" name=\"password\" placeholder=\"Enter Password\" />\n          <input type=\"submit\" />\n        </form>\n      </div>\n    )\n}\n\nexport default LoginPage\n","import React, {useContext} from 'react'\nimport AuthContext from '../context/AuthContext'\nimport { Link } from 'react-router-dom'\n\nconst Header = () => {\n  let {logoutUser} = useContext(AuthContext)\n  return (\n    <div>\n      <Link to=\"/\">Home</Link>\n      <span>  |  </span>\n      <Link to=\"/login\">Login</Link>\n      <span>  |  </span>\n      <Link onClick={ () => {logoutUser()} }>Logout</Link>\n    </div>\n  )\n}\n\nexport default Header\n","import React, { useContext } from 'react'\nimport { Route, Redirect } from 'react-router-dom'\nimport AuthContext from '../context/AuthContext';\n\n\nconst PrivateRoute = ({children, ...rest}) => {\n    let {user} = useContext(AuthContext);\n    return (\n        <Route {...rest}>\n            {\n            !user ? \n                <Redirect to=\"login\" /> \n            : children\n            }\n        </Route>\n    )\n}\n\nexport default PrivateRoute;","import React from 'react';\nimport './App.css';\nimport { BrowserRouter as Router, Route} from 'react-router-dom';\n\nimport { AuthProvider } from './context/AuthContext'\n\nimport HomePage from './pages/HomePage'\nimport LoginPage from './pages/LoginPage';\nimport Header from './components/Header';\nimport PrivateRoute from './utils/PrivateRoute';\n\n\n\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Router>\n        <AuthProvider>\n\n          <Header/>\n          <PrivateRoute path=\"/\" exact component={HomePage} />\n          <Route path=\"/login\" component={LoginPage} />\n\n        </AuthProvider>\n      </Router>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport App from './App';\n\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(\n  <App />\n);\n/*<React.StrictMode>\n    <App />\n  </React.StrictMode>*/"],"sourceRoot":""}